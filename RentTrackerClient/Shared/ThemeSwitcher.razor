@inject IJSRuntime JSRuntime

<button class="btn btn-outline-secondary btn-sm" @onclick="ToggleThemeAsync">
    <i class="bi @(_currentTheme == "dark" ? "bi-moon-stars" : "bi-sun")"></i>
</button>

@code {
    private string _currentTheme = "light";
    private readonly string[] _themes = new[] { "light", "dark" };

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                await JSRuntime.InvokeVoidAsync("initializeThemeManager");
                var storedTheme = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "theme");
                if (!string.IsNullOrEmpty(storedTheme))
                {
                    _currentTheme = storedTheme;
                    StateHasChanged();
                }
            }
            catch (Exception ex)
            {
                Console.Error.WriteLine($"Error initializing theme: {ex.Message}");
            }
        }
    }

    private async Task ToggleThemeAsync()
    {
        try
        {
            _currentTheme = _currentTheme == "dark" ? "light" : "dark";
            await JSRuntime.InvokeVoidAsync("themeManager.setTheme", _currentTheme);
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine($"Error changing theme: {ex.Message}");
        }
    }
}