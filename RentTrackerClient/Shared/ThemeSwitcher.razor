@inject IJSRuntime JSRuntime

<div class="theme-switcher">
    <div class="d-flex align-items-center gap-2">
        <i class="bi bi-palette text-primary"></i>
        <select id="themeSelect" class="form-select form-select-sm" value="@_currentTheme" @onchange="OnThemeChangeAsync">
            @foreach (var theme in _themes)
            {
                <option value="@theme">@(char.ToUpper(theme[0]) + theme[1..])</option>
            }
        </select>
    </div>
</div>

@code {
    private string _currentTheme = "default";
    private readonly string[] _themes = new[] { "default", "light", "mocha", "cappuccino" };

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                await JSRuntime.InvokeVoidAsync("initializeThemeManager");
                var storedTheme = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "theme");
                if (!string.IsNullOrEmpty(storedTheme))
                {
                    _currentTheme = storedTheme;
                    StateHasChanged();
                }
            }
            catch (Exception ex)
            {
                Console.Error.WriteLine($"Error initializing theme: {ex.Message}");
            }
        }
    }

    private async Task OnThemeChangeAsync(ChangeEventArgs e)
    {
        if (e.Value is string newTheme)
        {
            try
            {
                _currentTheme = newTheme;
                await JSRuntime.InvokeVoidAsync("themeManager.setTheme", newTheme);
            }
            catch (Exception ex)
            {
                Console.Error.WriteLine($"Error changing theme: {ex.Message}");
            }
        }
    }
}